<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. Using Segmented Images &mdash; py-lmd 1.0.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=5c2dde8a" />
      <link rel="stylesheet" type="text/css" href="../_static/fonts.css?v=5583d106" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=1ed6394b"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Example Notebooks" href="example_notebooks.html" />
    <link rel="prev" title="1. Quick Start" href="quickstart.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/py-lmd_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">1. Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#installation-from-github">1.1. Installation from Github</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#generating-shapes">1.2. Generating Shapes</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#using-the-py-lmd-tools">1.3. Using the py-lmd tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#numbers-and-letters">1.4. Numbers and Letters</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#text">1.5. Text</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Using Segmented Images</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#background">2.1. Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="#different-coordinate-systems">2.2. Different Coordinate Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-started-with-the-segmentationloader">2.3. Getting started with the SegmentationLoader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overview-of-configuration">2.4. Overview of Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#processing-order">2.5. Processing Order</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_notebooks.html">3. Example Notebooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="notebooks/generate_xml_from_segmentation_mask.html">3.1. Generate a Cutting XML from segmentation mask using the Segmentation Loader.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="notebooks/generate_xml_from_segmentation_mask.html#Load-Segmentation-Mask">3.1.1. Load Segmentation Mask</a></li>
<li class="toctree-l3"><a class="reference internal" href="notebooks/generate_xml_from_segmentation_mask.html#Define-cell-sets">3.1.2. Define cell sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="notebooks/generate_xml_from_segmentation_mask.html#Calibration-points">3.1.3. Calibration points</a></li>
<li class="toctree-l3"><a class="reference internal" href="notebooks/generate_xml_from_segmentation_mask.html#XML-generation">3.1.4. XML generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="notebooks/generate_xml_from_segmentation_mask.html#write-to-XML">3.1.5. write to XML</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/generate_xml_from_qupath_export.html">3.2. Generate cutting XML from exported results from QUPath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="notebooks/generate_xml_from_qupath_export.html#Import-libraries-and-define-helper-functions">3.2.1. Import libraries and define helper functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="notebooks/generate_xml_from_qupath_export.html#Import-GEOjson-regions">3.2.2. Import GEOjson regions</a></li>
<li class="toctree-l3"><a class="reference internal" href="notebooks/generate_xml_from_qupath_export.html#Calibration-points">3.2.3. Calibration points</a></li>
<li class="toctree-l3"><a class="reference internal" href="notebooks/generate_xml_from_qupath_export.html#Clean-up-Dataframe">3.2.4. Clean up Dataframe</a></li>
<li class="toctree-l3"><a class="reference internal" href="notebooks/generate_xml_from_qupath_export.html#Generate-shape-collection">3.2.5. Generate shape collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="notebooks/generate_xml_from_qupath_export.html#write-to-XML">3.2.6. write to XML</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="notebooks/generate_cutting_mask_svg.html">3.3. Convert SVG graphic into LMD excision instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="notebooks/generate_cutting_mask_svg.html#Visualize-Results">3.3.1. Visualize Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="notebooks/generate_cutting_mask_svg.html#Export-to-XML">3.3.2. Export to XML</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">4. py-lmd Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="modules.html#lmd-lib">4.1. lmd.lib</a><ul>
<li class="toctree-l3"><a class="reference internal" href="modules.html#collection">4.1.1. Collection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="modules.html#lmd.lib.Collection"><code class="docutils literal notranslate"><span class="pre">Collection</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.Collection.shapes"><code class="docutils literal notranslate"><span class="pre">Collection.shapes</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.Collection.calibration_points"><code class="docutils literal notranslate"><span class="pre">Collection.calibration_points</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.Collection.orientation_transform"><code class="docutils literal notranslate"><span class="pre">Collection.orientation_transform</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.Collection.add_shape"><code class="docutils literal notranslate"><span class="pre">Collection.add_shape()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.Collection.join"><code class="docutils literal notranslate"><span class="pre">Collection.join()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.Collection.load"><code class="docutils literal notranslate"><span class="pre">Collection.load()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.Collection.new_shape"><code class="docutils literal notranslate"><span class="pre">Collection.new_shape()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.Collection.plot"><code class="docutils literal notranslate"><span class="pre">Collection.plot()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.Collection.save"><code class="docutils literal notranslate"><span class="pre">Collection.save()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.Collection.stats"><code class="docutils literal notranslate"><span class="pre">Collection.stats()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.Collection.svg_to_lmd"><code class="docutils literal notranslate"><span class="pre">Collection.svg_to_lmd()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="modules.html#shape">4.1.2. Shape</a><ul>
<li class="toctree-l4"><a class="reference internal" href="modules.html#lmd.lib.Shape"><code class="docutils literal notranslate"><span class="pre">Shape</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.Shape.from_xml"><code class="docutils literal notranslate"><span class="pre">Shape.from_xml()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.Shape.to_xml"><code class="docutils literal notranslate"><span class="pre">Shape.to_xml()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="modules.html#segmentationloader">4.1.3. SegmentationLoader</a><ul>
<li class="toctree-l4"><a class="reference internal" href="modules.html#lmd.lib.SegmentationLoader"><code class="docutils literal notranslate"><span class="pre">SegmentationLoader</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.SegmentationLoader.check_cell_set_sanity"><code class="docutils literal notranslate"><span class="pre">SegmentationLoader.check_cell_set_sanity()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="modules.html#lmd.lib.SegmentationLoader.load_classes"><code class="docutils literal notranslate"><span class="pre">SegmentationLoader.load_classes()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="modules.html#module-lmd.tools">4.2. lmd.tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="modules.html#lmd.tools.ellipse"><code class="docutils literal notranslate"><span class="pre">ellipse()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="modules.html#lmd.tools.get_rotation_matrix"><code class="docutils literal notranslate"><span class="pre">get_rotation_matrix()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="modules.html#lmd.tools.glyph"><code class="docutils literal notranslate"><span class="pre">glyph()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="modules.html#lmd.tools.glyph_path"><code class="docutils literal notranslate"><span class="pre">glyph_path()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="modules.html#lmd.tools.makeCross"><code class="docutils literal notranslate"><span class="pre">makeCross()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="modules.html#lmd.tools.rectangle"><code class="docutils literal notranslate"><span class="pre">rectangle()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="modules.html#lmd.tools.text"><code class="docutils literal notranslate"><span class="pre">text()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">py-lmd</a>
      </nav>

      <div class="wy-nav-content">
<div class="git-ribbon">
  <a href="http://github.com/SwissDataScienceCenter" rel="me">Join us on GitHub</a>
</div>

        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">2. </span>Using Segmented Images</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/pages/segmentation_loader.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="using-segmented-images">
<h1><span class="section-number">2. </span>Using Segmented Images<a class="headerlink" href="#using-segmented-images" title="Link to this heading"></a></h1>
<section id="background">
<h2><span class="section-number">2.1. </span>Background<a class="headerlink" href="#background" title="Link to this heading"></a></h2>
<a class="reference internal image-reference" href="../_images/watershed.png"><img alt="../_images/watershed.png" class="align-right" src="../_images/watershed.png" style="width: 400.0px; height: 400.0px;" /></a>
<p>Although the py-lmd package is meant to serve as framework for creating your own workflows, generating cutting data based on segmentations is the central application of this package.
When biological images are segmented, every pixel receives a class or label. Labels can be used to identify single cells and distinguish them from the background or can categorize</p>
<blockquote>
<div><p>cells or areas based on phenotypes, functions or location.</p>
</div></blockquote>
<p>In the following example we will assume that a segmentation was performed to assign labels to individual cells and distinguish their cytosol from the background.
The procedures are though applicable to all types of labels.</p>
<dl class="simple">
<dt>As this process is so central to the usage of the Leica LMD, the <a class="reference internal" href="modules.html#lmd.lib.SegmentationLoader" title="lmd.lib.SegmentationLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">SegmentationLoader</span></code></a> can be used to create cutting data based on segmentation data.</dt><dd><p>The workflow was specifically designed to work with whole slide images, as large as the LMD membrane slides, and large numbers of single cells.
Therefore, different processing steps are included which optimize single cell shapes and decrease overall cutting time.</p>
</dd>
</dl>
</section>
<section id="different-coordinate-systems">
<h2><span class="section-number">2.2. </span>Different Coordinate Systems<a class="headerlink" href="#different-coordinate-systems" title="Link to this heading"></a></h2>
<p>Using images to generate cutting data with the py-lmd package makes it necessary to transform the image coordinate system to the Leica LMD coordinate system. Although this functionality is part of the package, it is important to highlight the differences in the coordinate systems and to keep in mind what coordinate system is used when calibration points are determined from image data.</p>
<p>The coordinates for the Leica LMD are defined as <cite>(x, y)</cite> coordinates with the x-axis extending to the right and the y-axis extending to the top. All cutting data should exist in this coordinate system and should be calibrated accordingly. When cutting data is generated based on whole slide images we have to keep in mind that images are often indexed differently. Images in Fiji or Numpy are indexed as <cite>(row, column)</cite> with the rows extending downwards and the columns extending to the right. If we want to identify positions in image data - like calibration crosses or single cells - we have to translate their position in the <cite>(row, column)</cite> format to the <cite>(x, y)</cite> format.</p>
<img alt="../_images/py-lmd-figures-01.png" src="../_images/py-lmd-figures-01.png" />
<p>The py-lmd library has been designed in a way which allows to transform the coordinate system prior to saving. Therefore one can specify all coordinates in the image coordinate system and rely on the library to handle the transformation. In this case the <cite>orientation_transform</cite> attribute needs to be set when the Collection is created.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">calibration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">]])</span>

<span class="n">collection</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">calibration_points</span> <span class="o">=</span> <span class="n">calibration</span><span class="p">)</span>
<span class="n">collection</span><span class="o">.</span><span class="n">orientation_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
<p>In this case  all coordinates for calibration points and shapes can be set in form of <cite>(row, column)</cite> coordinates. The orientation transform is only applied when the Collection is saved or, if desired, when the Collection is plotted.</p>
</section>
<section id="getting-started-with-the-segmentationloader">
<h2><span class="section-number">2.3. </span>Getting started with the SegmentationLoader<a class="headerlink" href="#getting-started-with-the-segmentationloader" title="Link to this heading"></a></h2>
<p>Before we can start with the <a class="reference internal" href="modules.html#lmd.lib.SegmentationLoader" title="lmd.lib.SegmentationLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">SegmentationLoader</span></code></a>, we have to load our image which contains the labels for our cells. The segmentation loader expects a numpy array of integers where the background is assigned to label 0. There are no further restrictions to the shape or number of labels other than being continuos. All pixel with a certain label need to be in contact with each other. Functional labels which assign cells based on the cell type must be converted.</p>
<p>As example we will use the cytosol segmentation seen above which can be found under <cite>notebooks/Image_Segmentation/segmentation_cytosol.tiff</cite>. First, we will load this image and convert it to a numpy array.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;segmentation_cytosol.tiff&#39;</span><span class="p">)</span>
<span class="n">segmentation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">im</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
</pre></div>
</div>
<p>Based on this segmentation we have to select group of cells. These groups can be assigned to separate wells and intersecting shapes and cutting paths will be optimized separately for every group. In our case, all cells will be selected and assigned to the same well A1.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">all_classes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">segmentation</span><span class="p">)</span>
<span class="n">cell_sets</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="n">all_classes</span><span class="p">,</span> <span class="s2">&quot;well&quot;</span><span class="p">:</span> <span class="s2">&quot;A1&quot;</span><span class="p">}]</span>
</pre></div>
</div>
<p>Next we need to specify the calibration points which were identified in the image and the coordinate transform which should be applied. By default, the <a class="reference internal" href="modules.html#lmd.lib.SegmentationLoader" title="lmd.lib.SegmentationLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">SegmentationLoader</span></code></a> will read all coordinates as <cite>(row, column)</cite> based on the top left origin. Therefore, the calibration points should be specified in the same way.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">calibration_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">],[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1000</span><span class="p">]])</span>

<span class="n">loader_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;orientation_transform&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can now create an instance of the <a class="reference internal" href="modules.html#lmd.lib.SegmentationLoader" title="lmd.lib.SegmentationLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">SegmentationLoader</span></code></a> and generate the cutting data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lmd.lib</span> <span class="kn">import</span> <span class="n">SegmentationLoader</span>
<span class="n">sl</span> <span class="o">=</span> <span class="n">SegmentationLoader</span><span class="p">(</span><span class="n">config</span> <span class="o">=</span> <span class="n">loader_config</span><span class="p">)</span>
<span class="n">shape_collection</span> <span class="o">=</span> <span class="n">sl</span><span class="p">(</span><span class="n">segmentation</span><span class="p">,</span>
                    <span class="n">cell_sets</span><span class="p">,</span>
                    <span class="n">calibration_points</span><span class="p">)</span>

<span class="n">shape_collection</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fig_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../_images/segmentation1.png" src="../_images/segmentation1.png" />
</section>
<section id="overview-of-configuration">
<h2><span class="section-number">2.4. </span>Overview of Configuration<a class="headerlink" href="#overview-of-configuration" title="Link to this heading"></a></h2>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Overview of Configuration Parameters.</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 12.5%" />
<col style="width: 62.5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head stub"><p>Parameter</p></th>
<th class="head"><p>Default Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">shape_dilation</span></code></p></th>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>dilation of the cutting mask in pixel before intersecting shapes in a selection group are merged</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">shape_erosion</span></code></p></th>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>erosion of the cutting mask in pixel before intersecting shapes in a selection group are merged</p></td>
</tr>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">binary_smoothing</span></code></p></th>
<td><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p></td>
<td><p>Cutting masks are transformed by binary dilation and erosion</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">convolution_smoothing</span></code></p></th>
<td><p><code class="docutils literal notranslate"><span class="pre">15</span></code></p></td>
<td><p>number of datapoints which are averaged for smoothing. The resolution of datapoints is twice as high as the resolution of pixels.</p></td>
</tr>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">poly_compression_factor</span></code></p></th>
<td><p><code class="docutils literal notranslate"><span class="pre">30</span></code></p></td>
<td><p>fold reduction of datapoints for compression</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">path_optimization</span></code></p></th>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;hilbert&quot;</span></code></p></td>
<td><p>Optimization of the cutting path inbetween shapes. Optimized paths improve the cutting time and the microscopes focus. valid options are <code class="docutils literal notranslate"><span class="pre">[&quot;none&quot;,</span> <span class="pre">&quot;hilbert&quot;,</span> <span class="pre">&quot;greedy&quot;]</span></code></p></td>
</tr>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">hilbert_p</span></code></p></th>
<td><p><code class="docutils literal notranslate"><span class="pre">7</span></code></p></td>
<td><p>Paramter required for hilbert curve based path optimization. Defines the order of the hilbert curve used, which needs to be tuned with the total cutting area.</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">greedy_k</span></code></p></th>
<td><p><code class="docutils literal notranslate"><span class="pre">20</span></code></p></td>
<td><p>Parameter required for greedy path optimization. Instead of a global distance matrix, the k nearest neighbours are approximated. The optimization problem is then greedily solved for the known set of nearest neighbours until the first set of neighbours is exhausted.Established edges are then removed and the nearest neighbour approximation is recursivly repeated.</p></td>
</tr>
<tr class="row-even"><th class="stub"><p><code class="docutils literal notranslate"><span class="pre">distance_heuristic</span></code></p></th>
<td><p><code class="docutils literal notranslate"><span class="pre">300</span></code></p></td>
<td><p>Overlapping shapes are merged based on a nearest neighbour heuristic. All selected shapes closer than distance_heuristic pixel are checked for overlap.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="processing-order">
<h2><span class="section-number">2.5. </span>Processing Order<a class="headerlink" href="#processing-order" title="Link to this heading"></a></h2>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">Processing Order</span><a class="headerlink" href="#id2" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 100.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Binary dilation of cell masks</p></td>
</tr>
<tr class="row-even"><td><p>Binary erosion of cell masks</p></td>
</tr>
<tr class="row-odd"><td><p><strong>If activated</strong> join intersecting shapes</p></td>
</tr>
<tr class="row-even"><td><p>Binary smoothing of joined cell masks</p></td>
</tr>
<tr class="row-odd"><td><p>Filling holes of joined cell masks</p></td>
</tr>
<tr class="row-even"><td><p>Smoothing by convolution</p></td>
</tr>
<tr class="row-odd"><td><p>Compress polygons</p></td>
</tr>
<tr class="row-even"><td><p>Optimize global cut path</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p><strong>binary_smoothing</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p>Binary smoothing by applying a binary dilation followed by a erosion of the same size.
Binary smoothing can extend above the convex hull and therefore lead to intersection with
other shapes. <code class="docutils literal notranslate"><span class="pre">binary_smoothing</span></code> does not change the number
of vertices in the polygon of a shape. Please see <code class="docutils literal notranslate"><span class="pre">poly_compression_factor</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">binary_smoothing:</span> <span class="pre">0</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">binary_smoothing:</span> <span class="pre">15</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">binary_smoothing:</span> <span class="pre">30</span></code></p></td>
</tr>
<tr class="row-even"><td><img alt="../_images/bin0.png" src="../_images/bin0.png" />
</td>
<td><img alt="../_images/bin15.png" src="../_images/bin15.png" />
</td>
<td><img alt="../_images/bin30.png" src="../_images/bin30.png" />
</td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p><strong>convolution_smoothing</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p>Smooth the polygon by applying a circular, linear convolution of given size.
The default convolution kernel with <code class="docutils literal notranslate"><span class="pre">n</span></code> elements is <code class="docutils literal notranslate"><span class="pre">[1/n,</span> <span class="pre">1/n,</span> <span class="pre">...</span> <span class="pre">,</span> <span class="pre">1/n]</span></code>.
By default a value of 15 is used. Values below 3 are not recommended.
In contrast to <code class="docutils literal notranslate"><span class="pre">binary_smoothing</span></code>, <code class="docutils literal notranslate"><span class="pre">convolution_smoothing</span></code> does not increase
the convex hull of the shape. When there are many deep recessions in the shape
<code class="docutils literal notranslate"><span class="pre">convolution_smoothing</span></code> might not be able to smooth these out and
<code class="docutils literal notranslate"><span class="pre">binary_smoothing</span></code> should be used. <code class="docutils literal notranslate"><span class="pre">convolution_smoothing</span></code> does not change the number
of vertices in the polygon of a shape. Please see <code class="docutils literal notranslate"><span class="pre">poly_compression_factor</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">convolution_smoothing:</span> <span class="pre">1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">convolution_smoothing:</span> <span class="pre">40</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">convolution_smoothing:</span> <span class="pre">80</span></code></p></td>
</tr>
<tr class="row-even"><td><img alt="../_images/conv1.png" src="../_images/conv1.png" />
</td>
<td><img alt="../_images/conv40.png" src="../_images/conv40.png" />
</td>
<td><img alt="../_images/conv80.png" src="../_images/conv80.png" />
</td>
</tr>
</tbody>
</table>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p><strong>poly_compression_factor</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p>Compress the number of vertices by a given factor.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">poly_compression_factor:</span> <span class="pre">1</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">poly_compression_factor:</span> <span class="pre">20</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">poly_compression_factor:</span> <span class="pre">40</span></code></p></td>
</tr>
<tr class="row-even"><td><img alt="../_images/comp1.png" src="../_images/comp1.png" />
</td>
<td><img alt="../_images/comp20.png" src="../_images/comp20.png" />
</td>
<td><img alt="../_images/comp40.png" src="../_images/comp40.png" />
</td>
</tr>
<tr class="row-odd"><td><img alt="../_images/comp_dots1.png" src="../_images/comp_dots1.png" />
</td>
<td><img alt="../_images/comp_dots20.png" src="../_images/comp_dots20.png" />
</td>
<td><img alt="../_images/comp_dots40.png" src="../_images/comp_dots40.png" />
</td>
</tr>
<tr class="row-even"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=====</span> <span class="n">Collection</span> <span class="n">Stats</span> <span class="o">=====</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">shapes</span><span class="p">:</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span><span class="mi">913</span>
<span class="o">============================</span>
<span class="n">Mean</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">702</span>
<span class="n">Min</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">599</span>
<span class="mi">5</span><span class="o">%</span> <span class="n">percentile</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">617</span>
<span class="n">Median</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">687</span>
<span class="mi">95</span><span class="o">%</span> <span class="n">percentile</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">811</span>
<span class="n">Max</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">839</span>
</pre></div>
</div>
</td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=====</span> <span class="n">Collection</span> <span class="n">Stats</span> <span class="o">=====</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">shapes</span><span class="p">:</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">245</span>
<span class="o">============================</span>
<span class="n">Mean</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">35</span>
<span class="n">Min</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">30</span>
<span class="mi">5</span><span class="o">%</span> <span class="n">percentile</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">31</span>
<span class="n">Median</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">34</span>
<span class="mi">95</span><span class="o">%</span> <span class="n">percentile</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">40</span>
<span class="n">Max</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">42</span>
</pre></div>
</div>
</td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=====</span> <span class="n">Collection</span> <span class="n">Stats</span> <span class="o">=====</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">shapes</span><span class="p">:</span> <span class="mi">7</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">123</span>
<span class="o">============================</span>
<span class="n">Mean</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">18</span>
<span class="n">Min</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">15</span>
<span class="mi">5</span><span class="o">%</span> <span class="n">percentile</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">15</span>
<span class="n">Median</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">17</span>
<span class="mi">95</span><span class="o">%</span> <span class="n">percentile</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">20</span>
<span class="n">Max</span> <span class="n">vertices</span><span class="p">:</span> <span class="mi">21</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quickstart.html" class="btn btn-neutral float-left" title="1. Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="example_notebooks.html" class="btn btn-neutral float-right" title="3. Example Notebooks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 Georg Wallmann, Sophia Mädler and Niklas Schmacke.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>